import{c as ke,j as t,a as P,e as ge,B as he,X as Pe,u as E}from"./index.Eoy0PIGW.js";import{S as Le,a as _e,b as Ee,c as Te,d as Ie,e as ze,f as M}from"./sidebar-r.D725WyqT.js";import{y as Z,z as Ve,A as Y,B as ee,D as Oe,E as te,o as re,i as O,l as Ae,F as se,w as A,G as x,H as Be,I as De,q as ye,u as ve,J as z,K as $,L as $e,M as be,Q as G,N as T,O as Ze,P as Fe,_ as ae,k as He,j as qe}from"./context.CUNpjwKz.js";import{M as B}from"./sidebar-l.CRgB3qwZ.js";import{a as ne,b as oe,L as ie,C as Ge,S as Re}from"./checkbox.AQu349VM.js";import{r as _}from"./index.DUAV1Q2A.js";import{c as q,l as U}from"./leaflet-src.B55YZO4x.js";import{b as V,a as F,u as k,l as J,s as Ke,m as le,g as Ue,h as Q}from"./geo-utils.DLH3P2WX.js";import{P as Je,a as Qe,b as Xe,C as xe,c as we,d as je,e as Ne,f as W,g as D,h as We}from"./popover.DwOXX8NX.js";import{y as I}from"./_astro-entry_react-toastify.BqZZ0Rhh.js";import{S as ce,G as Ye,I as et}from"./iconBase.DK9oy1VT.js";import{P as tt}from"./panel-left-close.DAuG0SUP.js";import"./clsx.B-dksMZM.js";import"./index.w2VhVQe9.js";import"./dialog.BhZgoQuL.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],de=ke("CircleX",rt);function R(e,n,r={}){const i=Z(e),l=Ve(n);for(let s=0;s<l.length-1;s++){let o=!1;if(r.ignoreEndVertices&&(s===0&&(o="start"),s===l.length-2&&(o="end"),s===0&&s+1===l.length-1&&(o="both")),st(l[s],l[s+1],i,o,typeof r.epsilon>"u"?null:r.epsilon))return!0}return!1}function st(e,n,r,i,l){const s=r[0],o=r[1],v=e[0],d=e[1],b=n[0],c=n[1],h=r[0]-v,w=r[1]-d,m=b-v,a=c-d,f=h*a-w*m;if(l!==null){if(Math.abs(f)>l)return!1}else if(f!==0)return!1;if(Math.abs(m)===Math.abs(a)&&Math.abs(m)===0)return i?!1:r[0]===e[0]&&r[1]===e[1];if(i){if(i==="start")return Math.abs(m)>=Math.abs(a)?m>0?v<s&&s<=b:b<=s&&s<v:a>0?d<o&&o<=c:c<=o&&o<d;if(i==="end")return Math.abs(m)>=Math.abs(a)?m>0?v<=s&&s<b:b<s&&s<=v:a>0?d<=o&&o<c:c<o&&o<=d;if(i==="both")return Math.abs(m)>=Math.abs(a)?m>0?v<s&&s<b:b<s&&s<v:a>0?d<o&&o<c:c<o&&o<d}else return Math.abs(m)>=Math.abs(a)?m>0?v<=s&&s<=b:b<=s&&s<=v:a>0?d<=o&&o<=c:c<=o&&o<=d;return!1}function at(e,n){var r=Y(e),i=Y(n),l=r.type,s=i.type;switch(l){case"Point":switch(s){case"MultiPoint":return nt(r,i);case"LineString":return R(r,i,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return V(r,i,{ignoreBoundary:!0});default:throw new Error("feature2 "+s+" geometry not supported")}case"MultiPoint":switch(s){case"MultiPoint":return ot(r,i);case"LineString":return it(r,i);case"Polygon":case"MultiPolygon":return lt(r,i);default:throw new Error("feature2 "+s+" geometry not supported")}case"LineString":switch(s){case"LineString":return ct(r,i);case"Polygon":case"MultiPolygon":return dt(r,i);default:throw new Error("feature2 "+s+" geometry not supported")}case"Polygon":switch(s){case"Polygon":case"MultiPolygon":return ut(r,i);default:throw new Error("feature2 "+s+" geometry not supported")}default:throw new Error("feature1 "+l+" geometry not supported")}}function nt(e,n){var r,i=!1;for(r=0;r<n.coordinates.length;r++)if(Ce(n.coordinates[r],e.coordinates)){i=!0;break}return i}function ot(e,n){for(var r=0;r<e.coordinates.length;r++){for(var i=!1,l=0;l<n.coordinates.length;l++)Ce(e.coordinates[r],n.coordinates[l])&&(i=!0);if(!i)return!1}return!0}function it(e,n){for(var r=!1,i=0;i<e.coordinates.length;i++){if(!R(e.coordinates[i],n))return!1;r||(r=R(e.coordinates[i],n,{ignoreEndVertices:!0}))}return r}function lt(e,n){for(var r=!0,i=!1,l=0;l<e.coordinates.length;l++){if(i=V(e.coordinates[l],n),!i){r=!1;break}i=V(e.coordinates[l],n,{ignoreBoundary:!0})}return r&&i}function ct(e,n){for(var r=0;r<e.coordinates.length;r++)if(!R(e.coordinates[r],n))return!1;return!0}function dt(e,n){var r=F(n),i=F(e);if(!Se(r,i))return!1;for(var l=!1,s=0;s<e.coordinates.length;s++){if(!V(e.coordinates[s],n))return!1;if(l||(l=V(e.coordinates[s],n,{ignoreBoundary:!0})),!l&&s<e.coordinates.length-1){var o=pt(e.coordinates[s],e.coordinates[s+1]);l=V(o,n,{ignoreBoundary:!0})}}return l}function ut(e,n){var r=F(e),i=F(n);if(!Se(i,r))return!1;for(var l=0;l<e.coordinates[0].length;l++)if(!V(e.coordinates[0][l],n))return!1;return!0}function Se(e,n){return!(e[0]>n[0]||e[2]<n[2]||e[1]>n[1]||e[3]<n[3])}function Ce(e,n){return e[0]===n[0]&&e[1]===n[1]}function pt(e,n){return[(e[0]+n[0])/2,(e[1]+n[1])/2]}const ft=ge("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ue({className:e,variant:n,...r}){return t.jsx("div",{className:P(ft({variant:n}),e),...r})}const pe=ge("m-1 transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 duration-300",{variants:{variant:{default:"border-foreground/10 text-foreground bg-card hover:bg-card/80",secondary:"border-foreground/10 bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",inverted:"inverted"}},defaultVariants:{variant:"default"}}),Me=_.forwardRef(({options:e,onValueChange:n,variant:r,defaultValue:i=[],placeholder:l="Select options",animation:s=0,maxCount:o=3,modalPopover:v=!1,className:d,...b},c)=>{const[h,w]=_.useState(i),[m,a]=_.useState(!1),[f,j]=_.useState(!1),g=u=>{if(u.key==="Enter")a(!0);else if(u.key==="Backspace"&&!u.currentTarget.value){const y=[...h];y.pop(),w(y),n(y)}},p=u=>{const y=h.includes(u)?h.filter(H=>H!==u):[...h,u];w(y),n(y)},C=()=>{w([]),n([])},N=()=>{a(u=>!u)},L=()=>{const u=h.slice(0,o);w(u),n(u)},S=()=>{if(h.length===e.length)C();else{const u=e.map(y=>y.value);w(u),n(u)}};return t.jsxs(Je,{open:m,onOpenChange:a,modal:v,children:[t.jsx(Qe,{asChild:!0,children:t.jsx(he,{ref:c,...b,onClick:N,className:P("flex w-full p-1 rounded-md border min-h-10 h-auto items-center justify-between bg-inherit hover:bg-inherit [&_svg]:pointer-events-auto",d),children:h.length>0?t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsxs("div",{className:"flex flex-wrap items-center",children:[h.slice(0,o).map(u=>{const y=e.find(K=>K.value===u),H=y?.icon;return t.jsxs(ue,{className:P(f?"animate-bounce":"",pe({variant:r})),style:{animationDuration:`${s}s`},children:[H&&t.jsx(H,{className:"h-4 w-4 mr-2"}),t.jsx("span",{className:"max-w-[150px] text-ellipsis overflow-hidden",children:y?.label}),t.jsx(de,{className:"ml-2 h-4 w-4 cursor-pointer",onClick:K=>{K.stopPropagation(),p(u)}})]},u)}),h.length>o&&t.jsxs(ue,{className:P("bg-transparent text-foreground border-foreground/1 hover:bg-transparent",f?"animate-bounce":"",pe({variant:r})),style:{animationDuration:`${s}s`},children:[`+ ${h.length-o} more`,t.jsx(de,{className:"ml-2 h-4 w-4 cursor-pointer",onClick:u=>{u.stopPropagation(),L()}})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(Pe,{className:"h-4 mx-2 cursor-pointer text-muted-foreground",onClick:u=>{u.stopPropagation(),C()}}),t.jsx(ce,{orientation:"vertical",className:"flex min-h-6 h-full"}),t.jsx(ne,{className:"h-4 mx-2 cursor-pointer text-muted-foreground"})]})]}):t.jsxs("div",{className:"flex items-center justify-between w-full mx-auto",children:[t.jsx("span",{className:"text-sm text-muted-foreground mx-3",children:l}),t.jsx(ne,{className:"h-4 cursor-pointer text-muted-foreground mx-2"})]})})}),t.jsx(Xe,{className:"w-auto p-0",align:"start",onEscapeKeyDown:()=>a(!1),children:t.jsxs(xe,{children:[t.jsx(we,{placeholder:"Search...",onKeyDown:g}),t.jsxs(je,{children:[t.jsx(Ne,{children:"No results found."}),t.jsxs(W,{children:[t.jsxs(D,{onSelect:S,className:"cursor-pointer",children:[t.jsx("div",{className:P("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",h.length===e.length?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:t.jsx(oe,{className:"h-4 w-4"})}),t.jsx("span",{children:"(Select All)"})]},"all"),e.map(u=>{const y=h.includes(u.value);return t.jsxs(D,{onSelect:()=>p(u.value),className:"cursor-pointer",children:[t.jsx("div",{className:P("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",y?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:t.jsx(oe,{className:"h-4 w-4"})}),u.icon&&t.jsx(u.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),t.jsx("span",{children:u.label})]},u.value)})]}),t.jsx(We,{}),t.jsx(W,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[h.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(D,{onSelect:C,className:"flex-1 justify-center cursor-pointer",children:"Clear"}),t.jsx(ce,{orientation:"vertical",className:"flex min-h-6 h-full"})]}),t.jsx(D,{onSelect:()=>a(!1),className:"flex-1 justify-center cursor-pointer max-w-full",children:"Close"})]})})]})]})})]})});Me.displayName="MultiSelect";function mt(e){return Ye({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M8 11h3v10h2V11h3l-4-4-4 4zM4 3v2h16V3H4z"},child:[]}]})(e)}function gt({minHeight:e,scrollTo:n,element:r,...i}){const[l,s]=_.useState(!1);return _.useEffect(()=>{const o=()=>{if(r){if(!r.current)return;s(r.current.scrollTop>=(e??0))}else s(document.documentElement.scrollTop>=(e??0))};return o(),r?r.current?(r.current.addEventListener("scroll",o),()=>r.current?.removeEventListener("scroll",o)):void 0:(document.addEventListener("scroll",o),()=>document.removeEventListener("scroll",o))},[]),t.jsx(t.Fragment,{children:l&&t.jsx(he,{onClick:()=>{if(r){if(!r.current)return;r.current.scrollTo({top:n??0,behavior:"smooth"})}else window.scrollTo({top:n??0,behavior:"smooth"})},variant:"ghost",className:"fixed rounded-full right-2 w-12 h-12 z-[1050] hover:bg-slate-500 p-1",...i,children:t.jsx(mt,{className:"!w-1/2 !h-1/2 "})})})}let X=!1;const Et=()=>{const e=E(ee),n=E(Oe),r=E(te),i=E(re),l=E(O),s=E(Ae),o=E(se),v=E(A),[d,b]=_.useState(""),c=se.set,h=_.useRef(null),w=()=>{s&&s.eachLayer(a=>{a.hidingZones&&s.removeLayer(a)})},m=(a,f=!1,j={})=>{if(!s)return;w();const g=U.geoJSON(a,{style:{color:"green",fillColor:"green",fillOpacity:.2},onEachFeature:f?(p,C)=>{C.on("click",async()=>{s&&(b(p.properties.properties.id),await me(p,s,o,m,n,i).catch(N=>{if(console.log(N),document.querySelectorAll(".Toastify__toast").length===0)return I.error("An error occurred")}))})}:void 0,pointToLayer(p,C){const N=U.marker(C,{icon:U.divIcon({html:'<div class="text-black bg-opacity-0"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M96 0C43 0 0 43 0 96L0 352c0 48 35.2 87.7 81.1 94.9l-46 46C28.1 499.9 33.1 512 43 512l39.7 0c8.5 0 16.6-3.4 22.6-9.4L160 448l128 0 54.6 54.6c6 6 14.1 9.4 22.6 9.4l39.7 0c10 0 15-12.1 7.9-19.1l-46-46c46-7.1 81.1-46.9 81.1-94.9l0-256c0-53-43-96-96-96L96 0zM64 96c0-17.7 14.3-32 32-32l256 0c17.7 0 32 14.3 32 32l0 96c0 17.7-14.3 32-32 32L96 224c-17.7 0-32-14.3-32-32l0-96zM224 288a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"></path></svg></div>',className:""})});return N.bindPopup(`<b>${p.properties["name:en"]||p.properties.name||"No Name Found"} (${J(p.geometry.coordinates)})</b>`),N},...j});g.hidingZones=!0,g.addTo(s)};return _.useEffect(()=>{if(!s||O.get())return;e&&n&&(async()=>{if(O.set(!0),r.length===0){I.error("At least one place type must be selected"),O.set(!1);return}const f=Be(await De(r[0],"Finding stations. This may take a while. Do not press any buttons while this is processing. Don't worry, it will be cached.","nwr","center",r.slice(1))).features,j=k(Ke(n,{tolerance:.001}));let g=f.map(p=>{const C=i,N=Z(p);return q(N,C,{steps:32,units:"miles",properties:p})}).filter(p=>!at(p,j));for(const p of ye.get())if(!(ve.get()&&p.data.drag)){if(p.id==="matching"&&(p.data.type==="same-first-letter-station"||p.data.type==="same-length-station"||p.data.type==="same-train-line")){const C=z([p.data.lng,p.data.lat]),N=$(C,x(g.map(S=>S.properties)));if(p.data.type==="same-train-line"){const S=await $e(N.properties.id);if(S.length===0){I.warning(`No train line found for ${N.properties["name:en"]||N.properties.name}`);continue}else g=g.filter(u=>{const y=parseInt(u.properties.properties.id.split("/")[1]);return p.data.same?S.includes(y):!S.includes(y)})}const L=N.properties["name:en"]||N.properties.name;if(!L)return I.error("No English name found");if(p.data.type==="same-first-letter-station"){const S=L[0].toUpperCase();g=g.filter(u=>{const y=u.properties.properties["name:en"]||u.properties.properties.name;return y?p.data.same?y[0].toUpperCase()===S:y[0].toUpperCase()!==S:!1})}else if(p.data.type==="same-length-station"){const S=L.length;g=g.filter(u=>{const y=u.properties.properties["name:en"]||u.properties.properties.name;return y?p.data.same?y.length===S:y.length!==S:!1})}}if(p.id==="measuring"&&(p.data.type==="mcdonalds"||p.data.type==="seven11")){const C=await be(p.data.type==="mcdonalds"?G.McDonalds:G.Seven11),N=$(z([p.data.lng,p.data.lat]),C),L=T(z([p.data.lng,p.data.lat]),N,{units:"miles"});g=g.filter(S=>{const u=z(Z(S.properties)),y=$(u,C);return p.data.hiderCloser?T(u,y,{units:"miles"})<L+i:T(u,y,{units:"miles"})>L-i})}}b(""),m(x(g.filter(p=>!v.includes(p.properties.properties.id))),!0),c(g),O.set(!1)})().catch(f=>{if(console.log(f),document.querySelectorAll(".Toastify__toast").length===0)return O.set(!1),I.error("An error occurred")}),e||s.eachLayer(f=>{f.hidingZones&&s.removeLayer(f)})},[n,e,r,i]),t.jsxs(Le,{side:"right",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"ml-4 mt-4 font-poppins text-2xl",children:"Hiding Zone"}),t.jsx(tt,{className:"mr-2 visible md:hidden scale-x-[-1]",onClick:()=>{_e.get().setOpenMobile(!1)}})]}),t.jsxs(Ee,{ref:h,children:[t.jsx(gt,{element:h,minHeight:500}),t.jsx(Te,{children:t.jsx(Ie,{children:t.jsxs(ze,{children:[t.jsxs(M,{className:B,children:[t.jsx(ie,{className:"font-semibold font-poppins",children:"Display hiding zones?"}),t.jsx(Ge,{defaultChecked:e,checked:e,onCheckedChange:ee.set,disabled:l})]}),t.jsx(M,{className:P(B,"text-orange-500"),children:"Warning: This feature can drastically slow down your device."}),t.jsx(M,{className:B,children:t.jsx(Me,{options:[{label:"Railway Stations",value:"[railway=station]"},{label:"Railway Halts",value:"[railway=halt]"},{label:"Railway Stops",value:"[railway=stop]"},{label:"Tram Stops",value:"[railway=tram_stop]"},{label:"Bus Stops",value:"[highway=bus_stop]"},{label:"Railway Stations Excluding Subways",value:"[railway=station][subway!=yes]"},{label:"Subway Stations",value:"[railway=station][subway=yes]"},{label:"Light Rail Stations",value:"[railway=station][light_rail=yes]"},{label:"Light Rail Halts",value:"[railway=halt][light_rail=yes]"}],onValueChange:te.set,defaultValue:r,placeholder:"Select allowed places",animation:2,maxCount:3,modalPopover:!0,className:"!bg-popover bg-opacity-100",disabled:l})}),t.jsxs(M,{children:[t.jsx(ie,{className:"font-semibold font-poppins ml-2",children:"Hiding Zone Radius"}),t.jsxs("div",{className:P(B,"gap-2 flex flex-row"),children:[t.jsx(et,{type:"number",className:"rounded-md p-2 w-16",defaultValue:i,onChange:a=>{re.set(parseFloat(a.target.value))},disabled:l}),t.jsx(Re,{trigger:"Unit",value:"miles",options:{miles:"Miles"},disabled:!0})]})]}),e&&o.length>0&&t.jsx(M,{className:"bg-popover hover:bg-accent relative flex cursor-pointer gap-2 select-none items-center rounded-sm px-2 py-2.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",onClick:w,disabled:l,children:"No Display"}),e&&o.length>0&&t.jsx(M,{className:"bg-popover hover:bg-accent relative flex cursor-pointer gap-2 select-none items-center rounded-sm px-2 py-2.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",onClick:()=>{b(""),m(x(o.filter(a=>a.properties.properties.id!==d).map(a=>a.properties)),!1)},disabled:l,children:"All Stations"}),e&&o.length>0&&t.jsx(M,{className:"bg-popover hover:bg-accent relative flex cursor-pointer gap-2 select-none items-center rounded-sm px-2 py-2.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",onClick:()=>{b(""),m(x(o.filter(a=>!v.includes(a.properties.properties.id))),!0)},disabled:l,children:"All Zones"}),e&&o.length>0&&t.jsx(M,{className:"bg-popover hover:bg-accent relative flex cursor-pointer gap-2 select-none items-center rounded-sm px-2 py-2.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",onClick:()=>{b(""),m(k(x(o.filter(a=>!v.includes(a.properties.properties.id)))))},disabled:l,children:"No Overlap"}),e&&d&&t.jsxs(M,{className:P(B,"bg-popover hover:bg-accent"),disabled:l,children:["Current:"," ",t.jsx("a",{href:`https://www.openstreetmap.org/${o.find(a=>a.properties.properties.id===d).properties.properties.id}`,target:"_blank",rel:"noreferrer",className:"text-blue-500",children:o.find(a=>a.properties.properties.id===d).properties.properties["name:en"]||o.find(a=>a.properties.properties.id===d).properties.properties.name||J(o.find(a=>a.properties.properties.id===d).properties.geometry.coordinates)})]}),e&&v.length>0&&t.jsx(M,{className:"bg-popover hover:bg-accent relative flex cursor-pointer gap-2 select-none items-center rounded-sm px-2 py-2.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",onClick:()=>{A.set([]),m(x(o),!0)},disabled:l,children:"Clear Disabled"}),e&&t.jsx(M,{className:"bg-popover hover:bg-accent relative flex cursor-pointer gap-2 select-none items-center rounded-sm px-2 py-2.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",onClick:()=>{A.set(o.map(a=>a.properties.properties.id)),w()},disabled:l,children:"Disable All"}),e&&t.jsxs(xe,{children:[t.jsx(we,{placeholder:"Search for a hiding zone...",disabled:l}),t.jsxs(je,{className:"max-h-full",children:[t.jsx(Ne,{children:"No hiding zones found."}),t.jsx(W,{children:o.map(a=>t.jsxs(D,{"data-station-id":a.properties.properties.id,className:P(v.includes(a.properties.properties.id)&&"line-through"),onSelect:async()=>{s&&setTimeout(()=>{if(X){X=!1;return}v.includes(a.properties.properties.id)?A.set([...v.filter(f=>f!==a.properties.properties.id)]):A.set([...v,a.properties.properties.id]),c([...o]),m(x(o.filter(f=>!A.get().includes(f.properties.properties.id))),!0)},100)},disabled:l,children:[a.properties.properties["name:en"]||a.properties.properties.name||J(a.properties.geometry.coordinates),t.jsx("button",{onClick:async()=>{s&&(X=!0,b(a.properties.properties.id),await me(a,s,o,m,n,i).catch(f=>{if(console.log(f),document.querySelectorAll(".Toastify__toast").length===0)return I.error("An error occurred")}))},className:"bg-slate-600 p-0.5 rounded-md",disabled:l,children:"View"})]},a.properties.properties.id))})]})]})]})})})]})]})},fe={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[-180,-90],[180,-90],[180,90],[-180,90],[-180,-90]]]}}]};async function me(e,n,r,i,l,s){const o=F(e),v=[[o[1],o[0]],[o[3],o[2]]];let d=x([k(x([...l.features,le(e)]))]);for(const c of ye.get())if(!(ve.get()&&c.data.drag)){if((c.id==="measuring"||c.id==="matching")&&(c.data.type==="aquarium"||c.data.type==="zoo"||c.data.type==="theme_park"||c.data.type==="museum"||c.data.type==="hospital"||c.data.type==="cinema"||c.data.type==="library"||c.data.type==="golf_course"||c.data.type==="consulate"||c.data.type==="park")){const h=await Ze(c.data);let w=30,m={features:[]};const a=[];for(;m.features.length===0;){m=await Fe({lat:e.properties.geometry.coordinates[1],lng:e.properties.geometry.coordinates[0],radius:w,unit:"miles",locationType:c.data.type},"Finding matching locations to hiding zone...");const f=m.features.map(g=>({distance:T(z(Z(g)),e.properties,{units:"miles"}),point:g}));if(f.length===0){w+=30;continue}const j=ae.minBy(f,"distance");if(j.distance+s*2>w){w=j.distance+s*2;continue}a.push(...f.filter(g=>g.distance<j.distance+s*2&&g.point.properties.name).map(g=>g.point))}if(c.id==="matching"){const j=Ue(x(a)).features.find(g=>g.properties.site.properties.name===h.properties.name);if(!j){c.data.same&&(d=fe);continue}c.data.same?d=k(x([...d.features,le(j)])):d=k(x([...d.features,j]))}else{const f=a.map(j=>q(Z(j),h.properties.distanceToPoint));c.data.hiderCloser?d=k(x([...d.features,Q(x(f))])):d=k(x([...d.features,...f]))}}if(c.id==="measuring"&&c.data.type==="rail-measure"){const h=z([c.data.lng,c.data.lat]),w=$(h,x(r.map(f=>f.properties.geometry))),m=T(h,w),a=r.filter(f=>T(e.properties.geometry,f.properties.geometry)<m+1.61*s).map(f=>q(f.properties.geometry,m));c.data.hiderCloser?d=k(x([...d.features,Q(x(a))])):d=k(x([...d.features,...a]))}if(c.id==="measuring"&&(c.data.type==="mcdonalds"||c.data.type==="seven11")){const h=await be(c.data.type==="mcdonalds"?G.McDonalds:G.Seven11),w=z([c.data.lng,c.data.lat]),m=$(w,h),a=T(w,m,{units:"miles"}),j=h.features.filter(g=>T(g,e.properties.geometry,{units:"miles"})<a+s).map(g=>q(g,a,{units:"miles"}));c.data.hiderCloser?d=k(x([...d.features,Q(x(j))])):d=k(x([...d.features,...j]))}d.type!=="FeatureCollection"&&(d={type:"FeatureCollection",features:[d]})}ae.isEqual(d,fe)&&I.warning("The hider cannot be in this hiding zone. This wasn't eliminated on the sidebar as its absence was caused by multiple criteria."),i(d),He.get()&&(qe.get()?n?.flyToBounds(v):n?.fitBounds(v));const b=document.querySelector(`[data-station-id="${e.properties.properties.id}"]`);b&&(b.scrollIntoView({behavior:"smooth",block:"center"}),b.classList.add("selected-card-background-temporary"),setTimeout(()=>{b.classList.remove("selected-card-background-temporary")},5e3))}export{Et as ZoneSidebar};
