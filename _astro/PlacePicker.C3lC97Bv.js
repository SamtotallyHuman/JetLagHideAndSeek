import{c as y,u as h,j as e,B as C,a as i,X as $,S as M}from"./index.ThHS-4Rn.js";import{r}from"./index.DUAV1Q2A.js";import{m as v,r as n,o as c,i as q,w as O,x,n as u,q as s,y as T,C as V}from"./context.D_LBmcSq.js";import{P as D,a as I,b as F,C as J,c as R,d as U,e as B,f as H,g as A}from"./popover.DPccBq-O.js";import{y as K}from"./_astro-entry_react-toastify.BqZZ0Rhh.js";import"./clsx.B-dksMZM.js";import"./index.w2VhVQe9.js";import"./dialog.BWcy9ahI.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],X=y("ChevronsUpDown",Q);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}]],z=y("SquareMinus",Z);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Y=y("SquarePlus",W);function ee(m,o=500){const[a,l]=r.useState(m);return r.useEffect(()=>{const d=setTimeout(()=>l(m),o);return()=>{clearTimeout(d)}},[m,o]),a}const ce=({className:m=""})=>{const o=h(v),a=h(n),l=h(c),d=h(q),[N,w]=r.useState(!1),[S,k]=r.useState(""),f=ee(S),[P,g]=r.useState([]),[L,j]=r.useState(!1),[_,E]=r.useState(!1);return r.useEffect(()=>{if(f===""){g([]);return}else j(!0),g([]),O(f,"en").then(t=>{g(t),j(!1)}).catch(t=>{console.log(t),E(!0),j(!1)})},[f]),e.jsxs(D,{open:N,onOpenChange:w,children:[e.jsx(I,{asChild:!0,children:e.jsxs(C,{variant:"outline",role:"combobox","aria-expanded":N,className:i("w-[300px] justify-between light text-slate-700",m),children:[l?"Polygon selected":o&&o.properties&&o.properties.name?[o,...a.map(t=>t.location)].map(t=>x(t)).join("; "):"Hiding bounds",e.jsx(X,{className:"opacity-50"})]})}),e.jsxs(F,{className:"w-[300px] p-0 light",children:[e.jsx("div",{className:i("font-normal flex flex-col",l&&"bg-muted text-muted-foreground"),children:[{location:o,added:!0,base:!0},...a].map((t,G)=>e.jsxs("div",{className:i("flex justify-between items-center px-3 py-2",G%2===1&&"bg-slate-100",!l&&"transition-colors duration-200 hover:bg-slate-200"),children:[e.jsx("span",{className:"w-[78%] text-ellipsis",children:x(t.location)}),e.jsxs("div",{className:i("flex flex-row gap-2 *:stroke-[1.5]",l&&"hidden"),children:[!t.base&&(t.added?e.jsx(Y,{className:i("text-green-700 cursor-pointer",d&&"text-muted-foreground cursor-not-allowed"),onClick:()=>{d||(t.added=!1,n.set([...a]),u.set(null),c.set(null),s.set([...s.get()]))}}):e.jsx(z,{className:i("text-red-700 cursor-pointer",d&&"text-muted-foreground cursor-not-allowed"),onClick:()=>{d||(t.added=!0,n.set([...a]),u.set(null),c.set(null),s.set([...s.get()]))}})),e.jsx($,{className:i("scale-[90%] text-gray-700 cursor-pointer hover:bg-slate-300 rounded-full transition-colors duration-200"),onClick:()=>{if(t.base){const p=a.filter(b=>b.added===!0);if(p.length>0)p[0].base=!0,n.set(n.get().filter(b=>b.base!==!0)),v.set(p[0].location);else return K.error("Please add another location in addition mode.",{autoClose:3e3})}else n.set(a.filter(p=>p.location.properties.osm_id!==t.location.properties.osm_id));u.set(null),c.set(null),s.set([...s.get()])}})]})]},x(t.location)))}),e.jsx(M,{className:"h-[0.5px]"}),e.jsxs(J,{shouldFilter:!1,children:[e.jsx(R,{placeholder:"Search place...",onKeyUp:t=>{k(t.currentTarget.value)}}),e.jsxs(U,{children:[e.jsx(B,{children:L?e.jsx(e.Fragment,{children:"Loading..."}):_?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"https://github.com/komoot/photon",className:"text-blue-500",children:"Photon"})," ","is down. Please draw a polygon instead at the bottom left of the map."]}):"No locations found."}),e.jsx(H,{children:P.map(t=>e.jsx(A,{onSelect:()=>{n.set([...n.get(),{added:!0,location:t,base:!1}]),u.set(null),c.set(null),s.set([...s.get()])},className:"cursor-pointer",children:x(t)},`${t.properties.osm_id}${t.properties.name}`))})]}),e.jsx(C,{variant:"outline",className:"font-normal bg-slate-50 hover:bg-slate-200",onClick:()=>{u.set(null),c.set(null),s.set([]),T(V.ZONE_CACHE)},children:"Clear Questions & Cache"}),l&&e.jsx(C,{variant:"outline",className:"font-normal hover:bg-slate-200",onClick:()=>{c.set(null),u.set(null),s.set([...s.get()])},children:"Reuse Preset Locations"})]})]})]})};export{ce as PlacePicker};
